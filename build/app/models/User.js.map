{"version":3,"sources":["../../../src/app/models/User.js"],"names":["User","Model","init","sequelize","name","Sequelize","STRING","email","password","VIRTUAL","password_hash","provider","BOOLEAN","addHook","user","bcrypt","hash","associate","models","belongsTo","File","foreignKey","as","checkPassword","compare"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;AAEA,MAAMA,IAAN,SAAmBC,gBAAnB,CAAyB;AACvB,SAAOC,IAAP,CAAYC,SAAZ,EAAuB;AACrB,UAAMD,IAAN,CACE;AACEE,MAAAA,IAAI,EAAEC,mBAAUC,MADlB;AAEEC,MAAAA,KAAK,EAAEF,mBAAUC,MAFnB;AAGEE,MAAAA,QAAQ,EAAEH,mBAAUI,OAHtB;AAIEC,MAAAA,aAAa,EAAEL,mBAAUC,MAJ3B;AAKEK,MAAAA,QAAQ,EAAEN,mBAAUO;AALtB,KADF,EAQE;AACET,MAAAA;AADF,KARF;AAaA,SAAKU,OAAL,CAAa,YAAb,EAA2B,MAAMC,IAAN,IAAc;AACvC,UAAIA,IAAI,CAACN,QAAT,EAAmB;AACjBM,QAAAA,IAAI,CAACJ,aAAL,GAAqB,MAAMK,kBAAOC,IAAP,CAAYF,IAAI,CAACN,QAAjB,EAA2B,CAA3B,CAA3B;AACD;AACF,KAJD;AAMA,WAAO,IAAP;AACD;;AAED,SAAOS,SAAP,CAAiBC,MAAjB,EAAyB;AACvB,SAAKC,SAAL,CAAeD,MAAM,CAACE,IAAtB,EAA4B;AAAEC,MAAAA,UAAU,EAAE,WAAd;AAA2BC,MAAAA,EAAE,EAAE;AAA/B,KAA5B;AACD;;AAEDC,EAAAA,aAAa,CAACf,QAAD,EAAW;AACtB,WAAOO,kBAAOS,OAAP,CAAehB,QAAf,EAAyB,KAAKE,aAA9B,CAAP;AACD;;AA9BsB;;eAiCVV,I","sourcesContent":["import Sequelize, { Model } from 'sequelize';\nimport bcrypt from 'bcryptjs';\n\nclass User extends Model {\n  static init(sequelize) {\n    super.init(\n      {\n        name: Sequelize.STRING,\n        email: Sequelize.STRING,\n        password: Sequelize.VIRTUAL,\n        password_hash: Sequelize.STRING,\n        provider: Sequelize.BOOLEAN,\n      },\n      {\n        sequelize,\n      }\n    );\n\n    this.addHook('beforeSave', async user => {\n      if (user.password) {\n        user.password_hash = await bcrypt.hash(user.password, 8);\n      }\n    });\n\n    return this;\n  }\n\n  static associate(models) {\n    this.belongsTo(models.File, { foreignKey: 'avatar_id', as: 'avatar' });\n  }\n\n  checkPassword(password) {\n    return bcrypt.compare(password, this.password_hash);\n  }\n}\n\nexport default User;\n"],"file":"User.js"}