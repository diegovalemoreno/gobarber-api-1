{"version":3,"sources":["../../../src/app/controllers/NotificationController.js"],"names":["NotificationController","index","req","res","checkIsProvider","User","findOne","where","id","userId","provider","status","json","error","notifications","Notification","find","user","sort","createdAt","limit","update","notification","findByIdAndUpdate","params","read","new"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,sBAAN,CAA6B;AAC3B,QAAMC,KAAN,CAAYC,GAAZ,EAAiBC,GAAjB,EAAsB;AACpB;;;AAGA,UAAMC,eAAe,GAAG,MAAMC,cAAKC,OAAL,CAAa;AACzCC,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAEN,GAAG,CAACO,MADH;AAELC,QAAAA,QAAQ,EAAE;AAFL;AADkC,KAAb,CAA9B;;AAOA,QAAI,CAACN,eAAL,EAAsB;AACpB,aAAOD,GAAG,CACPQ,MADI,CACG,GADH,EAEJC,IAFI,CAEC;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAFD,CAAP;AAGD;;AAED,UAAMC,aAAa,GAAG,MAAMC,sBAAaC,IAAb,CAAkB;AAC5CC,MAAAA,IAAI,EAAEf,GAAG,CAACO;AADkC,KAAlB,EAGzBS,IAHyB,CAGpB;AAAEC,MAAAA,SAAS,EAAE;AAAb,KAHoB,EAIzBC,KAJyB,CAInB,EAJmB,CAA5B;AAMA,WAAOjB,GAAG,CAACS,IAAJ,CAASE,aAAT,CAAP;AACD;;AAED,QAAMO,MAAN,CAAanB,GAAb,EAAkBC,GAAlB,EAAuB;AACrB,UAAMmB,YAAY,GAAG,MAAMP,sBAAaQ,iBAAb,CACzBrB,GAAG,CAACsB,MAAJ,CAAWhB,EADc,EAEzB;AAAEiB,MAAAA,IAAI,EAAE;AAAR,KAFyB,EAGzB;AAAEC,MAAAA,GAAG,EAAE;AAAP,KAHyB,CAA3B;AAMA,WAAOvB,GAAG,CAACS,IAAJ,CAASU,YAAT,CAAP;AACD;;AAnC0B;;eAsCd,IAAItB,sBAAJ,E","sourcesContent":["import Notification from '../schemas/Notification';\nimport User from '../models/User';\n\nclass NotificationController {\n  async index(req, res) {\n    /**\n     * Check if loggedUser is a provider\n     */\n    const checkIsProvider = await User.findOne({\n      where: {\n        id: req.userId,\n        provider: true,\n      },\n    });\n\n    if (!checkIsProvider) {\n      return res\n        .status(401)\n        .json({ error: 'Only provider can load notifications' });\n    }\n\n    const notifications = await Notification.find({\n      user: req.userId,\n    })\n      .sort({ createdAt: 'desc' })\n      .limit(20);\n\n    return res.json(notifications);\n  }\n\n  async update(req, res) {\n    const notification = await Notification.findByIdAndUpdate(\n      req.params.id,\n      { read: true },\n      { new: true }\n    );\n\n    return res.json(notification);\n  }\n}\n\nexport default new NotificationController();\n"],"file":"NotificationController.js"}