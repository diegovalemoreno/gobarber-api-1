{"version":3,"sources":["../../src/lib/Queue.js"],"names":["jobs","CancellationMail","Queue","constructor","queues","init","forEach","key","handle","bee","Bee","redis","redisConfig","add","queue","job","createJob","save","processQueue","on","handleFailure","process","err","console","log","name"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEA,MAAMA,IAAI,GAAG,CAACC,yBAAD,CAAb;;AAEA,MAAMC,KAAN,CAAY;AACVC,EAAAA,WAAW,GAAG;AACZ,SAAKC,MAAL,GAAc,EAAd;AAEA,SAAKC,IAAL;AACD;;AAEDA,EAAAA,IAAI,GAAG;AACLL,IAAAA,IAAI,CAACM,OAAL,CAAa,CAAC;AAAEC,MAAAA,GAAF;AAAOC,MAAAA;AAAP,KAAD,KAAqB;AAChC,WAAKJ,MAAL,CAAYG,GAAZ,IAAmB;AACjBE,QAAAA,GAAG,EAAE,IAAIC,iBAAJ,CAAQH,GAAR,EAAa;AAChBI,UAAAA,KAAK,EAAEC;AADS,SAAb,CADY;AAIjBJ,QAAAA;AAJiB,OAAnB;AAMD,KAPD;AAQD;;AAEDK,EAAAA,GAAG,CAACC,KAAD,EAAQC,GAAR,EAAa;AACd,WAAO,KAAKX,MAAL,CAAYU,KAAZ,EAAmBL,GAAnB,CAAuBO,SAAvB,CAAiCD,GAAjC,EAAsCE,IAAtC,EAAP;AACD;;AAEDC,EAAAA,YAAY,GAAG;AACblB,IAAAA,IAAI,CAACM,OAAL,CAAaS,GAAG,IAAI;AAClB,YAAM;AAAEN,QAAAA,GAAF;AAAOD,QAAAA;AAAP,UAAkB,KAAKJ,MAAL,CAAYW,GAAG,CAACR,GAAhB,CAAxB;AACAE,MAAAA,GAAG,CAACU,EAAJ,CAAO,QAAP,EAAiB,KAAKC,aAAtB,EAAqCC,OAArC,CAA6Cb,MAA7C;AACD,KAHD;AAID;;AAEDY,EAAAA,aAAa,CAACL,GAAD,EAAMO,GAAN,EAAW;AACtBC,IAAAA,OAAO,CAACC,GAAR,CAAa,SAAQT,GAAG,CAACD,KAAJ,CAAUW,IAAK,UAApC,EAA+CH,GAA/C;AACD;;AA/BS;;eAkCG,IAAIpB,KAAJ,E","sourcesContent":["import Bee from 'bee-queue';\nimport CancellationMail from '../app/jobs/CancellationMail';\nimport redisConfig from '../config/redis';\n\nconst jobs = [CancellationMail];\n\nclass Queue {\n  constructor() {\n    this.queues = {};\n\n    this.init();\n  }\n\n  init() {\n    jobs.forEach(({ key, handle }) => {\n      this.queues[key] = {\n        bee: new Bee(key, {\n          redis: redisConfig,\n        }),\n        handle,\n      };\n    });\n  }\n\n  add(queue, job) {\n    return this.queues[queue].bee.createJob(job).save();\n  }\n\n  processQueue() {\n    jobs.forEach(job => {\n      const { bee, handle } = this.queues[job.key];\n      bee.on('failed', this.handleFailure).process(handle);\n    });\n  }\n\n  handleFailure(job, err) {\n    console.log(`Queue ${job.queue.name}: FAILED`, err);\n  }\n}\n\nexport default new Queue();\n"],"file":"Queue.js"}